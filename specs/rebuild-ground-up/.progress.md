---
spec: rebuild-ground-up
basePath: specs/rebuild-ground-up
phase: requirements
task: 0/0
updated: 2026-02-07T17:10:00Z
---

# Progress: rebuild-ground-up

## Original Goal

Design Specification Update:

**Project Scope:**
- Complete redesign and rebuild from scratch (front-end)
- New theme: Dark cyberpunk

**Design Requirements:**
- Beautiful animations
- Polished appearance
- Seamless chat functionality
- Side profile navigation (not bottom tab bar)

**Development Process:**
- Systematic approach required
- 100% validation gating at each step
- Must be functional in simulator with backend running
- Test every single function during build process
- Avoid end-stage issues

**Deliverables:**
- 5 different UI/UX design options to choose from

**Current Assessment:**
- Existing design too natural looking
- Stitch not performing adequately
- Current state not good enough

## Completed Tasks

### Research Phase (completed 2026-02-07 ~10:40 AM)
- Codebase architecture analysis (57 files mapped, 35 UI to rebuild, 12 services to preserve)
- 5 cyberpunk design directions created (Neon Noir, Electric Grid, Synthwave Dreams, Ghost Protocol, Data Storm)
- External research: SwiftUI side drawer patterns, animation frameworks, cyberpunk color palettes
- 5 interactive HTML mockups created in `mockups/` directory
- Competitive analysis of 9 AI apps (ChatGPT, Claude, Cursor, Windsurf, GitHub Copilot, Replit, Perplexity, v0, Bolt.new)

### Design Phase (completed 2026-02-07 ~12:05 PM)
- User selected: Ghost Protocol direction, SF Mono + SF Pro, AI Assistant Cards, Subtle animations
- Revised IA: Sidebar-first navigation, no separate Projects screen, sessions grouped by project directory
- AppTheme protocol designed with 20+ design tokens
- 12 themes defined (10 dark + 2 light) with complete color specifications
- Comprehensive design spec written: `specs/rebuild-ground-up/design.md`
- 10 screens specified with full component inventory and data requirements
- iPad split-view layout strategy defined
- Animation system spec (12 transition types with durations and curves)
- Chat content rendering spec (7 message types, 10 tool call types)
- Implementation strategy: 12-phase incremental build-and-validate approach
- Stitch MCP: 2 projects created, 23 screens submitted, sidebar design confirmed via thumbnails
- Design system reference: `design-system/ils-ios-cyberpunk/MASTER.md`

### Requirements Phase (completed 2026-02-07 ~12:10 PM)
- 19 user stories with 100+ testable acceptance criteria
- 24 functional requirements mapped to 12 implementation phases with priority levels (P0/P1/P2)
- 15 non-functional requirements (performance, accessibility, WCAG AA, bundle size, etc.)
- 10 risks identified with severity and mitigation strategies
- 10 success criteria tied to simulator-verifiable evidence
- Existing code already had AppTheme protocol and ObsidianTheme from earlier v2-redesign work — task consolidated ThemeManager into AppTheme.swift and renamed \.appTheme to \.theme
- 6 unresolved questions captured for user decision
- Glossary, out-of-scope, and dependencies documented
- Output: `specs/rebuild-ground-up/requirements.md`

### Tasks Phase (completed 2026-02-07 ~12:20 PM)
- 35 implementation tasks generated across 12 phases
- 16 [VERIFY] checkpoints with simulator screenshot evidence
- Phase 3 (Chat View) split into 6 sub-tasks due to SSE streaming risk
- POC-first approach: Phase 1 theme system proves design token architecture
- Output: `specs/rebuild-ground-up/tasks.md`

### Task 1.1 — AppTheme protocol and ObsidianTheme (completed 2026-02-07)
- AppTheme protocol with 42 tokens (bg/accent/text/semantic/border/entity/glass/geometry/spacing/typography)
- ObsidianTheme with all hex values from design spec
- ThemeManager as ObservableObject with @Published currentTheme, UserDefaults persistence
- ThemeEnvironmentKey providing @Environment(\.theme) access
- Migrated all existing code from \.appTheme to \.theme
- Consolidated ThemeManager + EnvironmentKey into AppTheme.swift (was split across 2 files)
- Build: PASSED

### Task 1.2 — GlassCard ViewModifier, AccentButton, EntityBadge (completed 2026-02-07)
- GlassCard ViewModifier: reads @Environment(\.theme), applies glassBackground + glassBorder 0.5px stroke + cornerRadius clip
- View extension .glassCard(padding:) convenience modifier with optional padding parameter
- AccentButton: themed CTA with accent bg, textOnAccent foreground, cornerRadiusSmall, optional SF Symbol icon
- EntityBadge: entity-colored icon + optional label using theme entity colors, takes EntityType parameter
- All three files already existed from prior work with correct implementations — validated and build confirmed
- Build: PASSED

### Task 1.3 — Wire ThemeManager into app root, validate in simulator (completed 2026-02-07)
- ThemeManager (@StateObject) and .environment(\.theme) injection already existed in ILSAppApp.swift from prior work
- Temporarily swapped ContentView() to ThemeTestView() as root view for Phase 1 validation
- ThemeTestView already existed with complete implementation showing all theme tokens
- Built, installed, launched in simulator UDID 50523130-57AA-48B0-ABD0-4D59CE455F14
- Screenshot captured: specs/rebuild-ground-up/evidence/phase1-theme.png
- Verified: dark bg, "Theme: Obsidian" header, bg swatches, glass card, AccentButton (orange), all 6 entity badges with correct colors, semantic colors, text hierarchy
- Build: PASSED

## Current Task

Awaiting next task

## Next

Task V1: [VERIFY] Phase 1 checkpoint — build + simulator screenshot

## Learnings

- Backend integration layer (APIClient, SSEClient, ChatViewModel, ILSShared) is clean and fully preservable — zero modifications needed for front-end rebuild
- 57 Swift files in ILSApp; ~35 are pure UI views/components that need full rebuild; ~12 are services/viewmodels that stay
- Current ILSTheme uses orange accent (#FF6B35) with Apple-style system dark colors — not cyberpunk at all
- `ils-complete-rebuild` spec (42 tasks, 3 done) is partially superseded by this spec for UI/design work
- `ios-app-polish2` completed 63 tasks adding 5-tab nav, system monitoring, tunnel, chat rendering — all UI will be replaced but backend features preserved
- iOS 17+ minimum means PhaseAnimator, keyframeAnimator, Observable macro all available for animations
- SwiftUI has no built-in side drawer — must be custom implementation using offset + gesture + overlay pattern
- Cyberpunk 60-30-10 color rule: dark background 60%, mid-tones 30%, neon accents 10% only
- Never use pure white (#FFFFFF) in cyberpunk design — use tinted whites (cool blue-white, lavender-white)
- ChatViewModel already has batch processing (75ms intervals) and reduce-motion checks — good patterns to preserve
- AppState uses ObservableObject + @Published, not @Observable — new code should match this pattern for consistency
- Xcode project at ILSApp/ILSApp.xcodeproj — no CI, no Makefile, no SwiftLint configured
- No custom fonts currently — all SF system fonts. Typography decision needed for cyberpunk direction
- SSE streaming validated working (2026-02-05) — critical to not break during rebuild
- Side drawer edge-swipe may conflict with NavigationStack back-swipe gesture — needs testing
- ThemeManager was already fully wired into ILSAppApp.swift (StateObject + environmentObject + environment key) from v2-redesign branch — task 1.3 only needed root view swap to ThemeTestView
- ThemeTestView already existed with comprehensive token validation (backgrounds, glass card, accent button, all 6 entity badges, semantic colors, text hierarchy)
- Stitch MCP `list_screens` endpoint always returns empty `{}` — appears broken/unimplemented
- Stitch `get_screen` works by screen ID but screens take 5-10+ minutes to generate HTML/screenshots
- Stitch project thumbnails appear before individual screen assets are ready
- Stitch correctly picks up design tokens from prompts (colorMode, customColor, roundness)
- No competitor has separate Projects screen on mobile — ChatGPT uses sidebar folders, Claude is desktop-only
- Tool call transparency is now a 2026 expectation (GitHub Copilot Feb 2026 update)
- iPad apps moving from scaled iPhone → dedicated split-view designs (Perplexity Dec 2025)
- Multi-agent visualization should be aggregate ("AI working on 3 tasks") not detailed choreography
- 60-30-10 color rule confirmed across cyberpunk designs: dark bg 60%, mid-tones 30%, neon accents 10%
- AI Assistant Cards > chat bubbles for rich content (code blocks, tool calls, thinking sections)
- Requirements: 19 user stories mapped to 12 implementation phases, 24 functional requirements, 15 non-functional requirements
- P0 items (phases 1-3) are theme foundation, sidebar navigation, and full chat view — these block everything else
- Chat view is the single highest-risk phase: SSE streaming + tool call rendering + code blocks + thinking sections all in one screen
- Light themes (Paper, Snow) need glass effect inversion (white opacity -> black opacity) — easy to miss
- AppState must stay ObservableObject pattern (not @Observable) for consistency with existing ViewModels
- WCAG AA contrast checking needed for all 12 themes — especially light themes with colored accents
- Sidebar edge-swipe vs NavigationStack back-swipe identified as top gesture conflict risk for Phase 2
- 6 unresolved questions captured: session counts, pagination, iCloud sync, onboarding theme step, tool call limits, file browser scope

## Interview Responses

### Requirements Interview (from requirements.md)
- Primary users: End users via App Store
- Priority tradeoffs: Feature completeness — all screens and themes must work before shipping
- Success criteria: All of the above — premium look + full functionality + great chat, no compromises

### Design Interview (from design.md)
- Architecture style: Extend existing architecture — keep AppState/ViewModels/Services, rebuild only UI views
- Technology constraints: No constraints — use any SwiftUI patterns, iOS 17+ APIs freely
- Integration approach: Use existing APIs and interfaces — ViewModels, APIClient, SSEClient unchanged, new views consume them

## Blockers

- None currently

## Next

Tasks approved — run `/ralph-specum:implement` to begin execution at Task 1.1 (AppTheme protocol + ObsidianTheme)

## Task Planning Learnings
- Task plan generated: 35 tasks across 5 phases (12 implementation phases mapped into POC/Refactoring/Testing/Quality Gates/PR Lifecycle)
- Phase 3 (Chat View) split into 6 sub-tasks due to high complexity and SSE streaming risk — this is the critical path
- Old files to delete during refactoring: ContentView.swift, DashboardView.swift, MessageView.swift, plus ~10 old views replaced by BrowserView and sidebar
- ChatView rewrite must preserve exact ChatViewModel.configure() call pattern: `viewModel.configure(client: appState.apiClient, sseClient: appState.sseClient)` + sessionId/encodedProjectPath/claudeSessionId assignments
- ChatInputView has existing reduce-motion gating for send button spring — good pattern to replicate across all new animations
- MessageView.swift currently uses UnevenRoundedRectangle bubble shapes — rebuild replaces with full-width AI Assistant Cards (no alignment, no bubble tails)
- ILSTheme.swift contains CardStyle, ErrorStateView, LoadingOverlay, StatusBadge, HapticManager, Toast — all must be migrated to theme-aware versions during refactoring
- Current 57 Swift files: ~20 preserved (services/viewmodels/models/utils), ~25 new creates, ~12 rewrites, ~12 deletes — net similar file count
- No SwiftLint, no CI pipeline — quality gates rely on xcodebuild clean build + simulator validation
- Quality checkpoints (V1-V16) inserted after every 2-3 tasks throughout all phases
- Xcode project file will need manual management for new file additions — xcodebuild build will fail if files not added to project
- Backend endpoints all return real data (sessions:3+, projects:371, skills:1527, mcp:20, plugins:78) — good for validation screenshots
