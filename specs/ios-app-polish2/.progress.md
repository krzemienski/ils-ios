---
spec: ios-app-polish2
basePath: specs/ios-app-polish2
phase: tasks
task: 0/63
updated: 2026-02-06T23:18:00-05:00
---

# Progress: ios-app-polish2

## Original Goal

So it needs to be both two and then one, and then we should never need to do either of them. Right? Like the reality is, I'm not sure why we still have, if you know that there's missing features and stuff and you still haven't gotten full on, full validation. And so I know for a fact, it's not fully functional. And it's extremely frustrating because you know how to do the, you're not obviously doing the functional validation correctly. You need to figure out and sequentially think about this one and actually solve it for this actual run. You're allowed to take your time. So what we need to make for this one is basically I would like to see a cloudflare tunnel, like basically the ability for somebody to start up a cloudflare tunnel based on what they say, you know, run the ralph command for building the backend server and writing it without port. And so basically allow for that people that vocation to be able to access in a remote manner and explain to them how they can either supply their own if they have cloudflare and like get their own DNS or something like that. She's a custom domain or it will just be LRO assigned. And then basically ensure that we have the ability to actually add a backend host, like first opening the app, meaning like if there is no connection, you will be prompted to give you one to give one with an IP address. And if not, then there should be a screen there that maybe has a shell script that would go ahead and install and then run the backend server. We install ralph and run backend on someone's machine. If they gave you like SSH credentials and stuff like that, that would set the machine up and actually do that. Then it would start connecting. And then also then I want to full on audit of every single feature and make sure that there's a hundred percent parity. I want you to pull down the latest ralph orchestrator code, right? I also want to say, I want you to think of at least five or six different improvements for the code base and the user experience perspective. I explained to me why you need to triple check and redo a validation across everything. also, I want you to invoke the UI UX Pro skill and actually do a redesign. Really, really make sure that UI UX is also really focused on and actually beautifully adhered to it. And redo an entire sketch design too, because I don't like the current one.

**Additional (added during spec creation):** There also needs to be an in-depth system — a running process on the user's machine, potentially the ability to look at files. With Sage, I also want all the system resources, network, like a very in-depth monitoring system because they're running all these things on potential systems. They need to be able to see and debug and understand what the performance is happening throughout them. So, a very clean, beautiful, and actually functional, useful metrics of your host system.

## Completed Tasks

- [x] 1.1 Replace ContentView sidebar+sheet with TabView (5 tabs)
- [x] 1.2 Move Skills/MCP/Plugins into Settings sub-sections
- [x] 1.3 Add slim connection banner replacing blocking red bar
- [x] 2.1 Fix CreateSessionRequest to send advanced options
- [x] 2.2 Fix skill install optimistic state
- [x] 2.3 [VERIFY] Quality checkpoint after parity fixes batch 1
- [x] 2.4 Add session rename (swipe action + backend PUT endpoint)
- [x] 2.5 Add session export as markdown via share sheet
- [x] 2.6 Dynamic marketplace categories from API data
- [x] 2.7 Dynamic command palette with real Claude CLI commands
- [x] 4.1 Create MetricsWebSocketClient.swift for live data
- [x] 4.2 Create SystemMetricsViewModel and MetricChart components
- [x] 4.3 Build SystemMonitorView with metric cards and charts
- [x] 4.4 Create ProcessListView with search and sort
- [x] 4.5 Create FileBrowserView with breadcrumb navigation

## Task Phases

| Phase | Name | Tasks | Status |
|-------|------|-------|--------|
| 0 | Foundation | 0.1-0.5 (5) | Complete |
| 1 | Navigation Overhaul | 1.1-1.5 (5) | In Progress (1.1-1.4 done) |
| 2 | Feature Parity Fixes | 2.1-2.8 (8) | In Progress (2.1-2.7 done) |
| 3 | System Monitoring Backend | 3.1-3.5 (5) | Pending |
| 4 | System Monitoring iOS | 4.1-4.6 (6) | In Progress (4.1-4.5 done) |
| 5 | Cloudflare Tunnel | 5.1-5.5 (5) | Pending |
| 6 | Chat Rendering | 6.1-6.6 (6) | Pending |
| 7 | Onboarding Enhancement | 7.1-7.4 (4) | Pending |
| 8 | UI/UX Redesign | 8.1-8.9 (9) | Pending |
| 9 | Cleanup & Accessibility | 9.1-9.4 (4) | Pending |
| 10 | Final Validation | 10.1-10.3 (3) | Pending |
| 11 | PR Lifecycle | 11.1-11.3 (3) | Pending |

## Current Task

Awaiting next task (4.6 verify checkpoint)

## Learnings

- CreateSessionRequest drops advanced options: form collects systemPrompt, maxBudget, maxTurns, fallbackModel but only sends name/projectId/model
- SettingsView healthCheck path mismatch: `loadHealth()` calls `/api/v1/health` but endpoint is at root `/health`
- Dark mode toggle in Settings saves to backend config but ILSAppApp.swift hardcodes `.preferredColorScheme(.dark)` -- toggle has zero effect
- ClaudeCodeSDK is in Package.swift but never imported anywhere -- bypassed due to RunLoop/NIO incompatibility
- Command palette commands are hardcoded strings, not dynamic CLI commands
- Sidebar-as-sheet is the single biggest UX friction -- no persistent navigation, must open sheet for every tab switch
- Cloudflare quick tunnels (`cloudflared tunnel --url`) output URL to stdout containing `trycloudflare.com` -- can be parsed with regex
- Named Cloudflare tunnels require account + API token but support stable custom domains
- macOS system metrics: `host_processor_info()` for CPU, `host_statistics64()` for memory, `FileManager.attributesOfFileSystem` for disk
- Linux system metrics: `/proc/stat`, `/proc/meminfo`, `/proc/loadavg`, `/proc/net/dev`
- Swift Charts is native iOS 16+ -- no third-party dependency needed for real-time charting
- SSHService.swift + Citadel already functional for remote command execution (password + RSA auth)
- No "ralph orchestrator" code exists in codebase -- user needs to clarify what repo to pull
- WebSocket chat handler exists in backend (`ChatController.handleWebSocket()`) but iOS never uses it -- only SSE
- Permission decision endpoint (`POST /chat/permission/:requestId`) is a stub -- logs but does nothing
- GitHub skill install uses optimistic "Installed" state after 2-second delay regardless of actual result
- Marketplace categories are hardcoded strings, not from backend
- 24 of ~48 backend endpoints are used by iOS; SSH/auth endpoints unused
- Previous ios-app-polish spec validated 13 scenarios with 42 screenshots but user frustrated with incomplete end-to-end validation
- Requirements: 20 user stories, 8 functional requirement areas, 13 validation scenarios defined
- SSH provisioning deferred (AD-3) -- high risk, low immediate value vs Cloudflare quick tunnel
- Tab bar with 5 tabs (Dashboard/Sessions/Projects/System/Settings) is at iOS recommended limit; Skills/MCP/Plugins nested under Dashboard or Settings
- Entity color scheme decision: Sessions=#007AFF, Projects=#34C759, Skills=#AF52DE, MCP=#FF6B35, Plugins=#FFD60A, System=#30B0C7
- 8 new backend endpoints needed (3 tunnel, 4 system, 1 session rename)
- Feature parity has 12 issues; 2 deferred to won't-have (permission stub, WS chat unused)
- System metrics needs dual-platform support (macOS + Linux) -- `host_processor_info` vs `/proc/stat`
- Markdown rendering library choice is unresolved -- swift-markdown-ui (third-party) vs custom AttributedString
- Cost tracking depends on Claude CLI reliably outputting cost data per session

- CreateSessionRequest in ILSShared only had projectId/name/model/permissionMode — added systemPrompt/maxBudgetUSD/maxTurns fields
- APIClient.swift has its own local APIResponse/ListResponse types that conflict with ILSShared — cannot import ILSShared in APIClient
- RenameSessionRequest added to ILSShared Requests.swift alongside CreateSessionRequest
- GitHubSkillRow had optimistic 2s DispatchQueue delay — replaced with real async installFromGitHub() result
- MarketplacePlugin needs optional `category` field for dynamic category extraction
- ShareSheet uses UIViewControllerRepresentable wrapping UIActivityViewController with temp file
- SystemMonitorView.swift used ILSTheme.V2.textPrimary but no V2 namespace exists — tokens are directly on ILSTheme (e.g., ILSTheme.textPrimary)
- SystemMonitorView.swift was on disk but NOT in the Xcode project.pbxproj — must always add both file reference and build phase entry
- ConnectionBannerModifier pattern (ViewModifier + onChange) is cleaner than passing binding to standalone view for auto-dismiss behavior
- Phase 4 files (MetricsWebSocketClient, SystemMetricsViewModel, MetricChart, ProgressRing, ProcessListView, FileBrowserView) had PBXBuildFile + PBXFileReference entries but were NOT in PBXSourcesBuildPhase files array — Xcode silently ignores files not in the build phase even if they appear in the file tree
- Must add new files to FOUR places in project.pbxproj: PBXBuildFile, PBXFileReference, PBXGroup children, AND PBXSourcesBuildPhase files array

## Blockers

- Ralph orchestrator repo URL unknown -- user must clarify
- Markdown rendering library: fallback plan is AttributedString if swift-markdown-ui SPM integration is complex with Xcode project

## Next

Task 4.6 Phase 4 verify checkpoint (system monitoring builds)

## Task Planning Insights

- 63 total tasks across 12 phases; quality checkpoints every 2-3 implementation tasks
- Phase 0-1 are foundation (theme + navigation) -- must complete before any other phase
- Phases 3-7 can partially parallelize: Phase 3 (backend) is independent of Phase 6 (chat) and Phase 7 (onboarding)
- Phase 4 (System iOS) depends on both Phase 1 (TabView) and Phase 3 (backend endpoints)
- Phase 5 (tunnel) depends only on Phase 1 for settings UI placement
- Phase 8 (redesign) is the riskiest -- touches 10+ view files; quality checkpoint after every 2-3 tasks
- ContentView.swift uses sidebar-as-sheet pattern with SidebarItem enum + string-based selectedTab -- Phase 1 must rewrite this entirely to TabView
- ILSTheme.swift is 342 lines with CardStyle, DarkListStyle, ErrorStateView, EmptyStateView, ToastModifier, HapticManager -- Phase 0 adds EntityType alongside, Phase 8 updates CardStyle/Toast
- Package.swift has ClaudeCodeSDK + Citadel; only ClaudeCodeSDK removed (Citadel stays for future SSH)
- routes.swift registers controllers via `api.register(collection:)` -- new SystemController and TunnelController follow same pattern
- iOS app uses Xcode project (not SPM) for the app target -- adding swift-markdown-ui requires Xcode SPM package management, not Package.swift
- System metrics shared DTOs (Phase 3.5) must be in ILSShared target so both backend (Content conformance) and iOS (Decodable) can use them
- SettingsView already has sections for Connection, Appearance, Advanced, About -- Phase 1.2 adds "Manage" section, Phase 5.4 adds "Remote Access" NavigationLink
- NewSessionView has `buildChatOptions()` method that already constructs ChatOptions but is never called -- Phase 2.1 just needs to wire the existing method
- Functional validation (Phase 10) requires backend running on port 9090 AND simulator booted -- both must be active simultaneously
